import E from"global";import n,{Component as w,StrictMode as y,Fragment as C,useLayoutEffect as F,useRef as g}from"react";import u,{version as c}from"react-dom";var{FRAMEWORK_OPTIONS:d}=E,s=new Map,P=(t,o)=>{let{id:e,component:r}=o;if(!r)throw new Error(`Unable to render story ${e} as the component annotation is missing from the default export`);return n.createElement(r,{...t})},x=({callback:t,children:o})=>{let e=g();return F(()=>{e.current!==t&&(e.current=t,t())},[t]),o},M=async(t,o)=>{let e=await D(o);return new Promise(r=>{e?e.render(n.createElement(x,{callback:()=>r(null)},t)):u.render(t,o,()=>r(null))})},S=c&&(c.startsWith("18")||c.startsWith("0.0.0")),A=d?.legacyRootApi!==!0,h=A&&S,p=t=>{let o=s.get(t);o&&h?(o.unmount(),s.delete(t)):u.unmountComponentAtNode(t)},D=async t=>{if(!h)return null;let o=s.get(t);return o||(o=(await import("react-dom/client")).default.createRoot(t),s.set(t,o)),o},i=class extends w{constructor(){super(...arguments);this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidMount(){let{hasError:e}=this.state,{showMain:r}=this.props;e||r()}componentDidCatch(e){let{showException:r}=this.props;r(e)}render(){let{hasError:e}=this.state,{children:r}=this.props;return e?null:r}},l=d?.strictMode?y:C;async function T({storyContext:t,unboundStoryFn:o,showMain:e,showException:r,forceRemount:R},a){let m=n.createElement(i,{showMain:e,showException:r},n.createElement(o,{...t})),f=l?n.createElement(l,null,m):m;return R&&p(a),await M(f,a),()=>p(a)}export{P as a,T as b};
